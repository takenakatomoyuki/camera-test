<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>バーコード読み取り</title>
</head>
<body>
    <h1>バーコード読み取りテスト</h1>
    <div id="scanner"></div>
    <p id="result"></p>

    <!-- QuaggaJSの読み込み -->
    <script csrc="https://unpkg.com/@ericblade/quagga2@1.7.4/dist/quagga.min.js"></script>
    <script>
        const lambdaUrl = "https://zm1pticc9k.execute-api.ap-northeast-1.amazonaws.com/calcRestApi";

        window.onload = function () {
            Quagga.init({
                inputStream: {
                    type: "LiveStream",
                    target: document.querySelector('#scanner'),
                    constraints: {
                        facingMode: "environment" // 背面カメラ
                    }
                },
                decoder: {
                    readers: ["ean_reader"] // 一般的なバーコード
                }
            }, function (err) {
                if (err) {
                    console.error(err);
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(async function (result) {
                const barcode = result.codeResult.code;
                document.getElementById("result").textContent = "読み取ったバーコード: " + barcode;

                try {
                    const response = await fetch(lambdaUrl, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ barcode: barcode })
                    });

                    const resultData = await response.json();
                    alert(resultData.message); // Lambdaからのメッセージを表示
                } catch (error) {
                    console.error("送信エラー:", error);
                    alert("バーコード送信に失敗しました");
                }

                Quagga.stop(); // 読み取り後に停止
            });
        };
    </script>
</body>
</html>
